---
layout: post
title: B-11 Milestone 2
permalink: /page2/
---


# Feature Engineering I


Question 1: Create a Tidied Dataset
Using the training dataset, we engineer the following columns:
1.	Distance from Net:
o	Computed as the Euclidean distance from the (x, y) coordinates of the shot to the net.
o	Approximate the net as a single point (89, 0) or (-89, 0) and calculate the distance to the closest net.
2.	Angle from Net:
o	The angle between the shot position and the net, calculated using the arctan2 function.
3.	Is Goal:
o	Binary column indicating whether the shot resulted in a goal (1) or not (0).
4.	Empty Net:
o	Binary column indicating whether the shot was on an empty net (1) or not (0).
o	Missing values for this column (NaNs) are assumed to be 0.
Steps:
•	Extract only SHOT and GOAL events.
•	Add the required engineered features.
•	Clean the data by handling missing values and invalid coordinates.
Visualizations:
1.	Histogram of Shot Counts (Goals and No-Goals) Binned by Distance:


![image](https://github.com/user-attachments/assets/95b5f0df-4b18-4aca-8977-cfb388c06b24)

The histogram illustrates the distribution of shot counts based on the distance from the net, separated into two categories: "Goal" (red) and "No Goal" (blue). It is evident from the plot that the majority of shots occur within close proximity to the net, specifically under 20 feet. In this range, the number of goals is relatively higher compared to no-goals, reflecting the higher likelihood of scoring when a player is closer to the net. This aligns with hockey dynamics, where close-range shots provide players with better angles and reduce the goalie's reaction time.
As the distance increases, the frequency of shots decreases overall. Beyond 20 feet, the number of no-goals begins to dominate, with a sharp decline in goals. This trend continues into medium and long distances (20-60 feet), where the probability of scoring drops significantly due to reduced accuracy and the goalie's increased ability to react to the shot. At longer distances (e.g., >40 feet), no-goals make up the overwhelming majority of attempts, indicating that such shots are often speculative or intended to generate rebounds rather than direct scoring opportunities.
This pattern aligns with domain knowledge in hockey, where shorter distances offer higher scoring chances, while medium and long-range shots are more likely to be saved or miss the target entirely. Overall, the histogram accurately reflects the spatial dynamics of hockey shot outcomes and provides insights into how distance affects scoring probabilities.

2.	Histogram of Shot Counts (Goals and No-Goals) Binned by Angle:
![image](https://github.com/user-attachments/assets/fe20f05a-b286-4f34-8451-ce3365ef1370)

The histogram depicts the distribution of shot counts based on the angle from the net, with outcomes categorized as "Goal" (red) and "No Goal" (blue). It is clear from the plot that the majority of shots occur at extreme angles, approximately ±150 degrees, where the shot trajectory is nearly parallel to the goal line. Despite the high volume of shots at these extreme angles, the proportion of goals is significantly lower compared to no-goals, highlighting the difficulty of scoring from these positions.
In contrast, shots taken at central angles (close to 0°) are much more likely to result in goals, even though the total shot volume is relatively lower in this region. This aligns with hockey dynamics, where shots directly in front of the net provide the best scoring opportunities due to better alignment with the goal and reduced difficulty for the shooter.
The pattern of no-goals dominating across all angles, but especially at extreme angles, suggests that players often attempt shots in low-probability scenarios, possibly seeking deflections or rebounds rather than direct scoring opportunities. This histogram demonstrates that angle is a crucial determinant of scoring likelihood, with central angles offering higher probabilities of success compared to extreme angles.
3.	2D Histogram (Distance vs Angle):
![image](https://github.com/user-attachments/assets/4103678f-8a2c-4866-85c8-fa93ca0b9618)
The 2D histogram shows the joint distribution of hockey shots based on distance from the net and angle, with darker shades representing higher shot frequencies. Most shots cluster near the net (within 20 feet) and central angles (approximately -20° to 20°), indicating that players prioritize positions with higher scoring probabilities. A significant number of shots also occur at extreme angles (±150°) beyond 20 feet, likely as attempts for rebounds or deflections, though these are less likely to result in goals. The plot highlights a symmetric distribution across both sides of the rink and shows that shot frequency decreases significantly with increasing distance, reflecting the strategic importance of close, centrally aligned shots in hockey.
Question 2: Goal Rate by Distance and Angle

![image](https://github.com/user-attachments/assets/406bfd08-3bed-4f8d-bba7-9bae76a57078)

![image](https://github.com/user-attachments/assets/7eeba812-f7c6-4fab-94a4-c5ebecf44f46)

The plot shows the relationship between goal rate and the angle from the net, with the goal rate peaking at central angles (close to 0°) and decreasing as the angle becomes more extreme (closer to ±75°). At 0°, where shots are directly in front of the net, the goal rate exceeds 14%, highlighting the advantage of central positioning for scoring. As the angle moves away from the centerline, the goal rate gradually declines, reflecting the difficulty of scoring from wider angles due to reduced shooting opportunities and tighter goalie coverage. This pattern emphasizes that shots taken closer to the central line are strategically more effective, whereas extreme angles are less likely to result in goals.

# Baseline Models
Split dataset into train, test dataset:
Then start building the model:
1-	Logistic regression:
For Distance
We got this accuracy:
Accuracy (Distance Only): 0.9029694752697427

	Prediction:
 ![image](https://github.com/user-attachments/assets/e99f76c4-05f3-48e4-908b-a811751f45da)

 from this figure above we can measure the performance of the desired logistic regression model, and we found that the model acts well.
 ![image](https://github.com/user-attachments/assets/002169a7-fb3c-4fb5-a056-60159fbc9296)


 Display the correlation between Goal rate and Shot probability Model Percentile and we notice that changes.


Find cumulative proportion of goals:
 ![image](https://github.com/user-attachments/assets/cc7bebd5-5cdb-4486-9051-b9bcbee16393)

The plot illustrates the cumulative proportion of goals as a function of the shot probability model percentile, where shots are ranked by their predicted probabilities from the logistic regression model (using distance as a feature). The cumulative proportion increases steadily, indicating that the model successfully assigns higher probabilities to shots that are more likely to result in goals


Relibility:
 ![image](https://github.com/user-attachments/assets/99e3a5b1-3a9e-4468-8332-e75b623f3518)

The reliability diagram for the "Distance Only" logistic regression model compares the predicted probabilities of goals (positive class) to the observed fraction of actual goals. The dotted diagonal line represents a perfectly calibrated model, where the predicted probabilities match the actual probabilities. The plot shows that the classifier's predictions are generally below the diagonal, indicating underconfidence in its goal probability predictions.
For instance, predicted probabilities in the 0.1–0.2 range correspond to actual probabilities that are slightly higher. This suggests the model slightly underestimates the likelihood of scoring at lower probability ranges. The limited spread of points near the lower probability range reflects the dataset's inherent class imbalance, as most shots result in "No Goal." This diagram highlights the need for feature enhancement (e.g., incorporating angle_from_net) or recalibration techniques to improve the alignment of predicted probabilities with observed outcomes.

Other models:
![image](https://github.com/user-attachments/assets/91786a56-83a7-4089-a691-92a7affbeeff)

![image](https://github.com/user-attachments/assets/fe2b8c42-fdb1-4d18-b514-5970484bacaf)

 
![image](https://github.com/user-attachments/assets/fa4c5c5c-8b12-4bc5-b436-8897bc497832)

 The ROC curve visualizes the performance of different classifiers (Distance Only, Angle Only, and Distance + Angle) in distinguishing between classes, with the True Positive Rate (TPR) plotted against the False Positive Rate (FPR). The "Distance Only" and "Angle Only" models (green and orange curves, respectively) show slightly better performance than random guessing, with AUC values of 0.51, while the "Distance + Angle" model (blue curve) aligns closely with the random baseline (red dashed line), showing no improvement (AUC = 0.50). The diagonal gray line represents a model with no predictive power (AUC = 0.5). Overall, the classifiers exhibit minimal discrimination ability, as their performance is close to random.



1.	Distance Only:
o	Reasonable performance, as distance is a strong predictor.
o	Fails to capture angular variations that influence scoring.
2.	Angle Only:
o	Poorer performance compared to distance.
o	Angle is less predictive in isolation, as scoring depends on proximity as well.
3.	Distance + Angle:
o	Best performance among the models.
o	The combined features complement each other, improving predictions.
4.	Random Baseline:
o	Lowest performance, as expected, highlighting the importance of feature-driven predictions.


# Feature Engineering II
In this section, we are enrich the dataset with the following new features:
* **game_seconds**: We convert the minute and second timestamp into the total amount of seconds elapsed. This value extends over the whole game, i.e. it does not reset after a period ends and instead keeps counting.
* **shot_angle**: The angle relative to the horizontal line at the shot-taker's level (in degrees).
* **last_event**: Describes what event immediately preceds the current one.
* **last_event_x_coord**: X coordinate of the last event.
* **last_event_y_coord**: Y coordinate of the last event.
* **time_from_last_event**: Amount of time elapsed from last event until the current one (in seconds).
* **distance_from_last_event**: Distance from last event.
* **rebound**: True if the last event was also a shot, otherwise False.
* **last_shot_angle**: Makes life easier for calculating the "change_in_shot_angle" feature.
* **change_in_shot_angle**: Measure of the change in shot angle between current and previous shot (in degrees). Only include if the shot is a rebound, otherwise 0.
* **speed**: Defined as the distance from the previous event, divided by the time since the previous event.
* **power_play_time**: Indicates amount of time a team of event owner has been on power-play. Resets to 0 whenever player balance is restored.
* **num_friendly**: Number of friendly non-goalie skaters on the ice for team of event owner. Never goes below 3.
* **num_opposing**: Number of opposing non-goalie skaters on the ice for team of event owner. Never goes below 3.

Link to the DataFrame for Winnipeg vs Washington game on March 12, 2018: https://wandb.ai/ds_b11/my_project/artifacts/dataset/wpg_v_wsh_2017021065/v3

# Advanced Models


# Give it your best shot!


# Evaluate on test set






